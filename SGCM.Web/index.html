<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGCM - Sistema de Gerenciamento de Consultas Médicas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .main-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }

        .nav-pills .nav-link {
            border-radius: 10px;
            margin-bottom: 5px;
            transition: all 0.3s;
            color: #333;
        }

        .nav-pills .nav-link:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }

        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            margin: 0;
        }

        .stat-card p {
            margin: 5px 0 0 0;
            opacity: 0.9;
        }

        .btn-custom {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-custom:hover {
            transform: scale(1.05);
        }

        .table-hover tbody tr:hover {
            background-color: #f8f9fa;
            cursor: pointer;
        }

        .badge-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }

        .modal-content {
            border-radius: 15px;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 12px;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- Header -->
            <div class="header">
                <h1><i class="fas fa-hospital-alt"></i> SGCM</h1>
                <p>Sistema de Gerenciamento de Consultas Médicas - Consultório Vida Plena</p>
            </div>

            <!-- Content -->
            <div class="row g-0">
                <!-- Sidebar -->
                <div class="col-md-3 bg-light p-4">
                    <div class="nav flex-column nav-pills" role="tablist">
                        <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#dashboard">
                            <i class="fas fa-chart-line"></i> Dashboard
                        </button>
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#pacientes">
                            <i class="fas fa-users"></i> Pacientes
                        </button>
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#medicos">
                            <i class="fas fa-user-md"></i> Médicos
                        </button>
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#consultas">
                            <i class="fas fa-calendar-check"></i> Consultas
                        </button>
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#relatorios">
                            <i class="fas fa-file-alt"></i> Relatórios
                        </button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-9 p-4">
                    <div class="tab-content">
                        <!-- Dashboard -->
                        <div class="tab-pane fade show active" id="dashboard">
                            <h2><i class="fas fa-chart-line"></i> Dashboard</h2>
                            <hr>

                            <!-- Stats Cards -->
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="stat-card" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                                        <h3 id="totalPacientes">0</h3>
                                        <p>Pacientes</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%);">
                                        <h3 id="totalMedicos">0</h3>
                                        <p>Médicos</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                                        <h3 id="consultasHoje">0</h3>
                                        <p>Consultas Hoje</p>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                                        <h3 id="consultasProximas">0</h3>
                                        <p>Próximas</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Consultas de Hoje -->
                            <div class="card mt-4">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="fas fa-calendar-day"></i> Consultas de Hoje</h5>
                                    <div id="consultasHojeList" class="mt-3"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Pacientes -->
                        <div class="tab-pane fade" id="pacientes">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h2><i class="fas fa-users"></i> Pacientes</h2>
                                <button class="btn btn-primary btn-custom" data-bs-toggle="modal" data-bs-target="#modalCadastrarPaciente">
                                    <i class="fas fa-plus"></i> Novo Paciente
                                </button>
                            </div>
                            <hr>

                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Nome</th>
                                                    <th>CPF</th>
                                                    <th>Telefone</th>
                                                    <th>E-mail</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="pacientesList"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Médicos -->
                        <div class="tab-pane fade" id="medicos">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h2><i class="fas fa-user-md"></i> Médicos</h2>
                                <button class="btn btn-success btn-custom" data-bs-toggle="modal" data-bs-target="#modalCadastrarMedico">
                                    <i class="fas fa-plus"></i> Novo Médico
                                </button>
                            </div>
                            <hr>

                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Nome</th>
                                                    <th>CRM</th>
                                                    <th>Especialidade</th>
                                                    <th>Telefone</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="medicosList"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Consultas -->
                        <div class="tab-pane fade" id="consultas">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h2><i class="fas fa-calendar-check"></i> Consultas</h2>
                                <button class="btn btn-warning btn-custom" data-bs-toggle="modal" data-bs-target="#modalAgendarConsulta">
                                    <i class="fas fa-plus"></i> Agendar Consulta
                                </button>
                            </div>
                            <hr>

                            <!-- Filtros -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>Filtrar por Status:</label>
                                            <select class="form-select" id="filtroStatus" onchange="filtrarConsultas()">
                                                <option value="">Todos</option>
                                                <option value="Agendada">Agendada</option>
                                                <option value="Concluida">Concluída</option>
                                                <option value="Cancelada">Cancelada</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-body">
                                    <div id="consultasList"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Relatórios -->
                        <div class="tab-pane fade" id="relatorios">
                            <h2><i class="fas fa-file-alt"></i> Relatórios</h2>
                            <hr>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5><i class="fas fa-calendar-day"></i> Relatório do Dia</h5>
                                            <p>Visualize todas as consultas agendadas para uma data específica</p>
                                            <div class="mb-3">
                                                <label>Selecione a data:</label>
                                                <input type="date" class="form-control" id="dataRelatorioDia" value="">
                                            </div>
                                            <button class="btn btn-primary btn-custom" onclick="gerarRelatorioDia()">
                                                <i class="fas fa-file-pdf"></i> Gerar Relatório
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5><i class="fas fa-ban"></i> Relatório de Cancelamentos</h5>
                                            <p>Consultas canceladas no período</p>
                                            <div class="mb-2">
                                                <label>Data inicial:</label>
                                                <input type="date" class="form-control" id="dataInicioCancelamentos" value="">
                                            </div>
                                            <div class="mb-3">
                                                <label>Data final:</label>
                                                <input type="date" class="form-control" id="dataFimCancelamentos" value="">
                                            </div>
                                            <button class="btn btn-danger btn-custom" onclick="gerarRelatorioCancelamentos()">
                                                <i class="fas fa-file-pdf"></i> Gerar Relatório
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="relatorioOutput" class="mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cadastrar Paciente -->
    <div class="modal fade" id="modalCadastrarPaciente" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-plus"></i> Cadastrar Paciente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formPaciente">
                        <div class="mb-3">
                            <label class="form-label">Nome Completo *</label>
                            <input type="text" class="form-control" id="pacienteNome" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">CPF * (somente números)</label>
                            <input type="text" class="form-control" id="pacienteCPF" maxlength="11" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Telefone *</label>
                            <input type="text" class="form-control" id="pacienteTelefone" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">E-mail *</label>
                            <input type="email" class="form-control" id="pacienteEmail" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="cadastrarPaciente()">Cadastrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cadastrar Médico -->
    <div class="modal fade" id="modalCadastrarMedico" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-md"></i> Cadastrar Médico</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formMedico">
                        <div class="mb-3">
                            <label class="form-label">Nome Completo *</label>
                            <input type="text" class="form-control" id="medicoNome" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">CRM * (ex: 12345-SC)</label>
                            <input type="text" class="form-control" id="medicoCRM" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Especialidade *</label>
                            <select class="form-select" id="medicoEspecialidade" required>
                                <option value="">Selecione...</option>
                                <option value="Clínica Geral">Clínica Geral</option>
                                <option value="Cardiologia">Cardiologia</option>
                                <option value="Pediatria">Pediatria</option>
                                <option value="Ortopedia">Ortopedia</option>
                                <option value="Dermatologia">Dermatologia</option>
                                <option value="Ginecologia">Ginecologia</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Telefone *</label>
                            <input type="text" class="form-control" id="medicoTelefone" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="cadastrarMedico()">Cadastrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agendar Consulta -->
    <div class="modal fade" id="modalAgendarConsulta" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-calendar-plus"></i> Agendar Consulta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formConsulta">
                        <div class="mb-3">
                            <label class="form-label">Paciente *</label>
                            <select class="form-select" id="consultaPaciente" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Médico *</label>
                            <select class="form-select" id="consultaMedico" required>
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Data *</label>
                            <input type="date" class="form-control" id="consultaData" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Horário *</label>
                            <input type="time" class="form-control" id="consultaHora" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Observações</label>
                            <textarea class="form-control" id="consultaObs" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning" onclick="agendarConsulta()">Agendar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dados simulados (localStorage para persistência)
        let dadosSimulados = {
            pacientes: [],
            medicos: [],
            consultas: []
        };

        // Carregar dados do localStorage ou gerar dados de exemplo
        function inicializarDados() {
            const dadosSalvos = localStorage.getItem('sgcm_dados');
            if (dadosSalvos) {
                dadosSimulados = JSON.parse(dadosSalvos);
                // Converter strings de data para objetos Date
                dadosSimulados.consultas.forEach(c => {
                    c.dataHora = new Date(c.dataHora);
                });
            } else {
                gerarDadosExemplo();
            }
        }

        // Salvar dados no localStorage
        function salvarDados() {
            localStorage.setItem('sgcm_dados', JSON.stringify(dadosSimulados));
        }

        // Gerar dados de exemplo
        function gerarDadosExemplo() {
            // Pacientes
            dadosSimulados.pacientes = [
                {id: 'PAC-001', nome: 'João da Silva', cpf: '123.456.789-00', telefone: '(47) 99999-8888', email: 'joao@email.com', status: 'Ativo'},
                {id: 'PAC-002', nome: 'Maria Santos', cpf: '987.654.321-00', telefone: '(47) 98888-7777', email: 'maria@email.com', status: 'Ativo'},
                {id: 'PAC-003', nome: 'Pedro Costa', cpf: '111.222.333-44', telefone: '(47) 97777-6666', email: 'pedro@email.com', status: 'Ativo'},
                {id: 'PAC-004', nome: 'Ana Paula Lima', cpf: '222.333.444-55', telefone: '(47) 96666-5555', email: 'ana@email.com', status: 'Ativo'},
                {id: 'PAC-005', nome: 'Carlos Eduardo', cpf: '333.444.555-66', telefone: '(47) 95555-4444', email: 'carlos@email.com', status: 'Ativo'},
                {id: 'PAC-006', nome: 'Juliana Oliveira', cpf: '444.555.666-77', telefone: '(47) 94444-3333', email: 'juliana@email.com', status: 'Ativo'},
                {id: 'PAC-007', nome: 'Roberto Alves', cpf: '555.666.777-88', telefone: '(47) 93333-2222', email: 'roberto@email.com', status: 'Ativo'},
                {id: 'PAC-008', nome: 'Fernanda Souza', cpf: '666.777.888-99', telefone: '(47) 92222-1111', email: 'fernanda@email.com', status: 'Ativo'},
                {id: 'PAC-009', nome: 'Lucas Pereira', cpf: '777.888.999-00', telefone: '(47) 91111-0000', email: 'lucas@email.com', status: 'Ativo'},
                {id: 'PAC-010', nome: 'Patricia Mendes', cpf: '888.999.000-11', telefone: '(47) 90000-9999', email: 'patricia@email.com', status: 'Ativo'}
            ];

            // Médicos
            dadosSimulados.medicos = [
                {id: 'MED-001', nome: 'Dr. Roberto Lima', crm: '11223-SC', especialidade: 'Clínica Geral', telefone: '(47) 98765-5678', status: 'Ativo'},
                {id: 'MED-002', nome: 'Dr. Carlos Mendes', crm: '12345-SC', especialidade: 'Cardiologia', telefone: '(47) 98765-4321', status: 'Ativo'},
                {id: 'MED-003', nome: 'Dra. Ana Paula Souza', crm: '67890-SC', especialidade: 'Pediatria', telefone: '(47) 98765-1234', status: 'Ativo'},
                {id: 'MED-004', nome: 'Dr. Fernando Costa', crm: '13579-SC', especialidade: 'Ortopedia', telefone: '(47) 98765-2468', status: 'Ativo'},
                {id: 'MED-005', nome: 'Dra. Juliana Santos', crm: '24680-SC', especialidade: 'Dermatologia', telefone: '(47) 98765-3690', status: 'Ativo'},
                {id: 'MED-006', nome: 'Dra. Mariana Oliveira', crm: '98765-SC', especialidade: 'Ginecologia', telefone: '(47) 98765-7410', status: 'Ativo'}
            ];

            // Gerar consultas
            gerarConsultasSimuladas();
            salvarDados();
        }

        // Gerar consultas simuladas
        function gerarConsultasSimuladas() {
            const hoje = new Date();
            let id = 1;

            dadosSimulados.medicos.forEach((medico, idx) => {
                // 3 realizadas
                for (let i = 0; i < 3; i++) {
                    const data = new Date(hoje);
                    data.setDate(data.getDate() - (10 + i * 2));
                    data.setHours(8 + i * 2, 0, 0, 0);
                    
                    dadosSimulados.consultas.push({
                        id: `CON-${String(id++).padStart(3, '0')}`,
                        paciente: dadosSimulados.pacientes[i % 10],
                        medico: medico,
                        dataHora: data,
                        status: 'Concluida',
                        observacoes: 'Atendimento realizado com sucesso'
                    });
                }

                // 5 agendadas
                for (let i = 0; i < 5; i++) {
                    const data = new Date(hoje);
                    data.setDate(data.getDate() + (i + 1 + idx));
                    data.setHours(9 + i, 0, 0, 0);
                    
                    dadosSimulados.consultas.push({
                        id: `CON-${String(id++).padStart(3, '0')}`,
                        paciente: dadosSimulados.pacientes[(3 + i) % 10],
                        medico: medico,
                        dataHora: data,
                        status: 'Agendada',
                        observacoes: 'Consulta de rotina'
                    });
                }

                // 2 canceladas
                for (let i = 0; i < 2; i++) {
                    const data = new Date(hoje);
                    data.setDate(data.getDate() + (6 + i + idx));
                    data.setHours(14 + i, 0, 0, 0);
                    
                    dadosSimulados.consultas.push({
                        id: `CON-${String(id++).padStart(3, '0')}`,
                        paciente: dadosSimulados.pacientes[(8 + i) % 10],
                        medico: medico,
                        dataHora: data,
                        status: 'Cancelada',
                        observacoes: 'Paciente solicitou remarcação'
                    });
                }
            });

            // Consultas para hoje
            const hojeConsulta1 = new Date(hoje);
            hojeConsulta1.setHours(8, 0, 0, 0);
            dadosSimulados.consultas.push({
                id: `CON-${String(id++).padStart(3, '0')}`,
                paciente: dadosSimulados.pacientes[0],
                medico: dadosSimulados.medicos[1],
                dataHora: hojeConsulta1,
                status: 'Concluida',
                observacoes: 'Paciente apresentou melhora'
            });

            const proximaConsulta = new Date();
            proximaConsulta.setHours(proximaConsulta.getHours() + 1, 0, 0, 0);
            dadosSimulados.consultas.push({
                id: `CON-${String(id++).padStart(3, '0')}`,
                paciente: dadosSimulados.pacientes[1],
                medico: dadosSimulados.medicos[2],
                dataHora: proximaConsulta,
                status: 'Agendada',
                observacoes: 'Consulta de acompanhamento'
            });

            const hojeConsulta2 = new Date(hoje);
            hojeConsulta2.setHours(14, 0, 0, 0);
            dadosSimulados.consultas.push({
                id: `CON-${String(id++).padStart(3, '0')}`,
                paciente: dadosSimulados.pacientes[2],
                medico: dadosSimulados.medicos[3],
                dataHora: hojeConsulta2,
                status: 'Agendada',
                observacoes: 'Avaliação ortopédica'
            });
        }

        // Cadastrar Paciente
        function cadastrarPaciente() {
            const nome = document.getElementById('pacienteNome').value;
            const cpf = document.getElementById('pacienteCPF').value;
            const telefone = document.getElementById('pacienteTelefone').value;
            const email = document.getElementById('pacienteEmail').value;

            if (!nome || !cpf || !telefone || !email) {
                alert('Preencha todos os campos!');
                return;
            }

            // Verificar CPF duplicado
            if (dadosSimulados.pacientes.find(p => p.cpf.replace(/\D/g, '') === cpf)) {
                alert('CPF já cadastrado!');
                return;
            }

            const id = `PAC-${String(dadosSimulados.pacientes.length + 1).padStart(3, '0')}`;
            const cpfFormatado = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');

            dadosSimulados.pacientes.push({
                id: id,
                nome: nome,
                cpf: cpfFormatado,
                telefone: telefone,
                email: email,
                status: 'Ativo'
            });

            salvarDados();
            carregarPacientes();
            atualizarDashboard();

            // Limpar formulário e fechar modal
            document.getElementById('formPaciente').reset();
            bootstrap.Modal.getInstance(document.getElementById('modalCadastrarPaciente')).hide();

            alert('✓ Paciente cadastrado com sucesso!');
        }

        // Cadastrar Médico
        function cadastrarMedico() {
            const nome = document.getElementById('medicoNome').value;
            const crm = document.getElementById('medicoCRM').value;
            const especialidade = document.getElementById('medicoEspecialidade').value;
            const telefone = document.getElementById('medicoTelefone').value;

            if (!nome || !crm || !especialidade || !telefone) {
                alert('Preencha todos os campos!');
                return;
            }

            // Verificar CRM duplicado
            if (dadosSimulados.medicos.find(m => m.crm === crm)) {
                alert('CRM já cadastrado!');
                return;
            }

            const id = `MED-${String(dadosSimulados.medicos.length + 1).padStart(3, '0')}`;

            dadosSimulados.medicos.push({
                id: id,
                nome: nome,
                crm: crm,
                especialidade: especialidade,
                telefone: telefone,
                status: 'Ativo'
            });

            salvarDados();
            carregarMedicos();
            atualizarDashboard();

            // Limpar formulário e fechar modal
            document.getElementById('formMedico').reset();
            bootstrap.Modal.getInstance(document.getElementById('modalCadastrarMedico')).hide();

            alert('✓ Médico cadastrado com sucesso!');
        }

        // Agendar Consulta
        function agendarConsulta() {
            const pacienteId = document.getElementById('consultaPaciente').value;
            const medicoId = document.getElementById('consultaMedico').value;
            const data = document.getElementById('consultaData').value;
            const hora = document.getElementById('consultaHora').value;
            const obs = document.getElementById('consultaObs').value;

            if (!pacienteId || !medicoId || !data || !hora) {
                alert('Preencha todos os campos obrigatórios!');
                return;
            }

            const paciente = dadosSimulados.pacientes.find(p => p.id === pacienteId);
            const medico = dadosSimulados.medicos.find(m => m.id === medicoId);

            const dataHora = new Date(`${data}T${hora}`);

            // Verificar se horário está disponível
            const conflito = dadosSimulados.consultas.find(c => 
                c.medico.id === medicoId && 
                c.dataHora.getTime() === dataHora.getTime() &&
                c.status === 'Agendada'
            );

            if (conflito) {
                alert('⚠ Horário já ocupado para este médico!');
                return;
            }

            const id = `CON-${String(dadosSimulados.consultas.length + 1).padStart(3, '0')}`;

            dadosSimulados.consultas.push({
                id: id,
                paciente: paciente,
                medico: medico,
                dataHora: dataHora,
                status: 'Agendada',
                observacoes: obs
            });

            salvarDados();
            carregarConsultas();
            atualizarDashboard();

            // Limpar formulário e fechar modal
            document.getElementById('formConsulta').reset();
            bootstrap.Modal.getInstance(document.getElementById('modalAgendarConsulta')).hide();

            alert('✓ Consulta agendada com sucesso!');
        }

        // Carregar opções de pacientes e médicos no modal de consulta
        function carregarOpcoesConsulta() {
            const selectPaciente = document.getElementById('consultaPaciente');
            const selectMedico = document.getElementById('consultaMedico');

            selectPaciente.innerHTML = '<option value="">Selecione...</option>' +
                dadosSimulados.pacientes.filter(p => p.status === 'Ativo').map(p => 
                    `<option value="${p.id}">${p.nome} (${p.cpf})</option>`
                ).join('');

            selectMedico.innerHTML = '<option value="">Selecione...</option>' +
                dadosSimulados.medicos.filter(m => m.status === 'Ativo').map(m => 
                    `<option value="${m.id}">${m.nome} - ${m.especialidade}</option>`
                ).join('');
        }

        // Atualizar dashboard
        function atualizarDashboard() {
            document.getElementById('totalPacientes').textContent = dadosSimulados.pacientes.length;
            document.getElementById('totalMedicos').textContent = dadosSimulados.medicos.length;

            const hoje = new Date().toDateString();
            const consultasHoje = dadosSimulados.consultas.filter(c => c.dataHora.toDateString() === hoje);
            document.getElementById('consultasHoje').textContent = consultasHoje.length;

            const agora = new Date();
            const proximas = dadosSimulados.consultas.filter(c => {
                const diff = c.dataHora - agora;
                return diff > 0 && diff <= 2 * 60 * 60 * 1000 && c.status === 'Agendada';
            });
            document.getElementById('consultasProximas').textContent = proximas.length;

            // Listar consultas de hoje
            const lista = document.getElementById('consultasHojeList');
            if (consultasHoje.length === 0) {
                lista.innerHTML = '<p class="text-muted">Nenhuma consulta agendada para hoje</p>';
            } else {
                lista.innerHTML = consultasHoje.map(c => `
                    <div class="alert alert-${c.status === 'Concluida' ? 'success' : c.status === 'Cancelada' ? 'danger' : 'warning'}">
                        <strong>${c.dataHora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}</strong> - 
                        ${c.medico.nome} (${c.medico.especialidade}) - 
                        ${c.paciente.nome} - 
                        <span class="badge bg-${c.status === 'Concluida' ? 'success' : c.status === 'Cancelada' ? 'danger' : 'warning'}">${c.status}</span>
                    </div>
                `).join('');
            }
        }

        // Carregar pacientes
        function carregarPacientes() {
            const tbody = document.getElementById('pacientesList');
            tbody.innerHTML = dadosSimulados.pacientes.map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td>${p.nome}</td>
                    <td>${p.cpf}</td>
                    <td>${p.telefone}</td>
                    <td>${p.email}</td>
                    <td><span class="badge bg-success">${p.status}</span></td>
                </tr>
            `).join('');
        }

        // Carregar médicos
        function carregarMedicos() {
            const tbody = document.getElementById('medicosList');
            tbody.innerHTML = dadosSimulados.medicos.map(m => `
                <tr>
                    <td>${m.id}</td>
                    <td>${m.nome}</td>
                    <td>${m.crm}</td>
                    <td>${m.especialidade}</td>
                    <td>${m.telefone}</td>
                    <td><span class="badge bg-success">${m.status}</span></td>
                </tr>
            `).join('');
        }

        // Carregar consultas
        function carregarConsultas() {
            const div = document.getElementById('consultasList');
            const consultas = dadosSimulados.consultas.sort((a, b) => b.dataHora - a.dataHora);
            
            div.innerHTML = consultas.map(c => `
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <strong>${c.id}</strong><br>
                                <small>${c.dataHora.toLocaleDateString('pt-BR')}</small><br>
                                <small>${c.dataHora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}</small>
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-user"></i> ${c.paciente.nome}<br>
                                <small class="text-muted">${c.paciente.cpf}</small>
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-user-md"></i> ${c.medico.nome}<br>
                                <small class="text-muted">${c.medico.especialidade}</small>
                            </div>
                            <div class="col-md-2">
                                <span class="badge badge-status bg-${c.status === 'Concluida' ? 'success' : c.status === 'Cancelada' ? 'danger' : 'warning'}">${c.status}</span>
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-sm btn-outline-primary" onclick="verDetalhes('${c.id}')">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filtrar consultas
        function filtrarConsultas() {
            const filtro = document.getElementById('filtroStatus').value;
            const consultas = filtro ? dadosSimulados.consultas.filter(c => c.status === filtro) : dadosSimulados.consultas;
            
            const div = document.getElementById('consultasList');
            div.innerHTML = consultas.sort((a, b) => b.dataHora - a.dataHora).map(c => `
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <strong>${c.id}</strong><br>
                                <small>${c.dataHora.toLocaleDateString('pt-BR')}</small><br>
                                <small>${c.dataHora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}</small>
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-user"></i> ${c.paciente.nome}<br>
                                <small class="text-muted">${c.paciente.cpf}</small>
                            </div>
                            <div class="col-md-3">
                                <i class="fas fa-user-md"></i> ${c.medico.nome}<br>
                                <small class="text-muted">${c.medico.especialidade}</small>
                            </div>
                            <div class="col-md-2">
                                <span class="badge badge-status bg-${c.status === 'Concluida' ? 'success' : c.status === 'Cancelada' ? 'danger' : 'warning'}">${c.status}</span>
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-sm btn-outline-primary" onclick="verDetalhes('${c.id}')">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Ver detalhes da consulta
        function verDetalhes(id) {
            const consulta = dadosSimulados.consultas.find(c => c.id === id);
            if (consulta) {
                alert(`Detalhes da Consulta ${id}\n\n` +
                    `Paciente: ${consulta.paciente.nome}\n` +
                    `Médico: ${consulta.medico.nome}\n` +
                    `Data/Hora: ${consulta.dataHora.toLocaleString('pt-BR')}\n` +
                    `Status: ${consulta.status}\n` +
                    `Observações: ${consulta.observacoes}`);
            }
        }

        // Gerar relatório do dia
        function gerarRelatorioDia() {
            const dataInput = document.getElementById('dataRelatorioDia').value;
            let dataConsulta;
            
            if (dataInput) {
                dataConsulta = new Date(dataInput + 'T00:00:00');
            } else {
                dataConsulta = new Date();
            }

            const dataString = dataConsulta.toDateString();
            const consultasDia = dadosSimulados.consultas.filter(c => c.dataHora.toDateString() === dataString);
            
            const agendadas = consultasDia.filter(c => c.status === 'Agendada').length;
            const concluidas = consultasDia.filter(c => c.status === 'Concluida').length;
            const canceladas = consultasDia.filter(c => c.status === 'Cancelada').length;
            
            const relatorio = `
                <div class="card">
                    <div class="card-body">
                        <h4>Relatório de Consultas - ${dataConsulta.toLocaleDateString('pt-BR')}</h4>
                        <hr>
                        <h5>RESUMO GERAL:</h5>
                        <ul>
                            <li>Total de consultas: ${consultasDia.length}</li>
                            <li>Concluídas: ${concluidas} (${consultasDia.length ? (concluidas*100/consultasDia.length).toFixed(0) : 0}%)</li>
                            <li>Canceladas: ${canceladas} (${consultasDia.length ? (canceladas*100/consultasDia.length).toFixed(0) : 0}%)</li>
                            <li>Pendentes: ${agendadas} (${consultasDia.length ? (agendadas*100/consultasDia.length).toFixed(0) : 0}%)</li>
                        </ul>
                        
                        <h5 class="mt-4">CONSULTAS CONCLUÍDAS (${concluidas}):</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Horário</th>
                                        <th>Médico</th>
                                        <th>Paciente</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${consultasDia.filter(c => c.status === 'Concluida').map(c => `
                                        <tr>
                                            <td>${c.dataHora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}</td>
                                            <td>${c.medico.nome}</td>
                                            <td>${c.paciente.nome}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <h5 class="mt-4">CONSULTAS PENDENTES (${agendadas}):</h5>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Horário</th>
                                        <th>Médico</th>
                                        <th>Paciente</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${consultasDia.filter(c => c.status === 'Agendada').map(c => `
                                        <tr>
                                            <td>${c.dataHora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}</td>
                                            <td>${c.medico.nome}</td>
                                            <td>${c.paciente.nome}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-success btn-custom" onclick="window.print()">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('relatorioOutput').innerHTML = relatorio;
        }

        // Gerar relatório de cancelamentos
        function gerarRelatorioCancelamentos() {
            const dataInicioInput = document.getElementById('dataInicioCancelamentos').value;
            const dataFimInput = document.getElementById('dataFimCancelamentos').value;

            let dataInicio, dataFim;

            if (dataInicioInput) {
                dataInicio = new Date(dataInicioInput + 'T00:00:00');
            } else {
                dataInicio = new Date();
                dataInicio.setMonth(dataInicio.getMonth() - 1);
            }

            if (dataFimInput) {
                dataFim = new Date(dataFimInput + 'T23:59:59');
            } else {
                dataFim = new Date();
            }

            const canceladas = dadosSimulados.consultas.filter(c => 
                c.status === 'Cancelada' && 
                c.dataHora >= dataInicio && 
                c.dataHora <= dataFim
            );
            
            const relatorio = `
                <div class="card">
                    <div class="card-body">
                        <h4>Relatório de Consultas Canceladas</h4>
                        <p><strong>Período:</strong> ${dataInicio.toLocaleDateString('pt-BR')} a ${dataFim.toLocaleDateString('pt-BR')}</p>
                        <hr>
                        <p><strong>Total de cancelamentos:</strong> ${canceladas.length}</p>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Data Original</th>
                                        <th>Horário</th>
                                        <th>Paciente</th>
                                        <th>Médico</th>
                                        <th>Especialidade</th>
                                        <th>Motivo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${canceladas.map(c => `
                                        <tr>
                                            <td>${c.id}</td>
                                            <td>${c.dataHora.toLocaleDateString('pt-BR')}</td>
                                            <td>${c.dataHora.toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}</td>
                                            <td>${c.paciente.nome}</td>
                                            <td>${c.medico.nome}</td>
                                            <td>${c.medico.especialidade}</td>
                                            <td>${c.observacoes}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-success btn-custom" onclick="window.print()">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('relatorioOutput').innerHTML = relatorio;
        }

        // Inicializar datas nos campos de relatório
        function inicializarDatasRelatorio() {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataRelatorioDia').value = hoje;
            
            const umMesAtras = new Date();
            umMesAtras.setMonth(umMesAtras.getMonth() - 1);
            document.getElementById('dataInicioCancelamentos').value = umMesAtras.toISOString().split('T')[0];
            document.getElementById('dataFimCancelamentos').value = hoje;
        }

        // Inicializar ao carregar a página
        window.onload = function() {
            inicializarDados();
            atualizarDashboard();
            carregarPacientes();
            carregarMedicos();
            carregarConsultas();
            inicializarDatasRelatorio();
            
            // Carregar opções quando abrir modais
            document.getElementById('modalAgendarConsulta').addEventListener('show.bs.modal', carregarOpcoesConsulta);
        };
    </script>
</body>
</html>